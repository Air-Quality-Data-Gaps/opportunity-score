# declare directory
dir <- ("~/Desktop/AQLI/aq_data_gap")
# Set Up ------
library(tidyverse)
library(ggbump)
library(readxl)
library(googlesheets4)
library(sf)
`%notin%` <- Negate(`%in%`)
# Data ------
opp_score_2025 <- read_csv("output/opp_score_wo_state_dept.csv")
opp_score_2023 <- read_csv("archive/2023/data/output/opportunity_score_corrected.csv")
# maps ------
gadm0_aqli_shp <- st_read("~/Desktop/AQLI/shapefiles/global/gadm0/aqli_gadm0_final_june302023.shp")
maps_data <- opp_score_2025 %>%
right_join(gadm0_aqli_shp, by = c("name" = "name0")) %>%
select(-geometry, geometry) %>%
mutate(plot_bands = factor(ifelse(bands_2 %in% c("Medium", "Low") | is.na(bands_2), "Lower", bands_2),
levels = c("High", "Medium-high", "Lower"))) %>%
st_as_sf()
## fig A2: opportunity score map ------
maps_data <- opp_score_2025 %>%
right_join(gadm0_aqli_shp, by = c("name" = "name0")) %>%
select(-geometry, geometry) %>%
mutate(plot_bands = factor(ifelse(is.na(bands_2), "Not calculated", bands_2),
levels = c("High", "Medium-high", "Medium", "Low", "Not calculated"))) %>%
st_as_sf()
opp_score_map <- ggplot() +
geom_sf(data = gadm0_aqli_shp, color = "black", fill = "white", lwd = 0.05) +
geom_sf(data = maps_data, mapping = aes(fill = bands_2), color = "black", lwd = 0.05) +
scale_fill_manual(values = c("High" = "#01497C",
"Medium-high" = "#38718F",
"Medium"= "#A6C0B4",
"Low"= "#DDE7C7",
"Not calculated" = "darkgray")) +
ggthemes::theme_map() +
labs(fill = "Opportunity Score") +
theme(plot.title = element_text(hjust = 0.5, size = 15),
plot.background = element_rect(fill = "#edf3f9", colour = "#edf3f9"),
plot.subtitle = element_text(hjust = 0.5, size = 7),
plot.caption = element_text(hjust = 0.7, size = 9, face = "italic"),
legend.position = "bottom",
legend.justification = "center",
legend.background = element_rect(color = "black"),
legend.text = element_text(size = 14),
legend.title = element_text(size = 15),
legend.box.margin = margin(b = 1, unit = "cm"),
legend.key = element_rect(color = "black"),
legend.box.spacing = unit(0, "cm"),
legend.direction = "horizontal") +
guides(fill = guide_legend(nrow = 1))
ggsave("output/figures/figureA2.png", height = 10, width = 15, opp_score_map)
maps_data <- opp_score_2025 %>%
right_join(gadm0_aqli_shp, by = c("name" = "name0")) %>%
select(-geometry, geometry) %>%
mutate(plot_bands = factor(ifelse(bands_2 %in% c("Medium", "Low") | is.na(bands_2), "Lower", bands_2),
levels = c("High", "Medium-high", "Lower")),
bands_2 = factor(ifelse(is.na(bands_2), "Not calculated", bands_2),
levels = c("High", "Medium-high", "Medium", "Low", "Not calculated"))) %>%
st_as_sf()
opp_score_map <- ggplot() +
geom_sf(data = gadm0_aqli_shp, color = "black", fill = "white", lwd = 0.05) +
geom_sf(data = maps_data, mapping = aes(fill = bands_2), color = "black", lwd = 0.05) +
scale_fill_manual(values = c("High" = "#01497C",
"Medium-high" = "#38718F",
"Medium"= "#A6C0B4",
"Low"= "#DDE7C7",
"Not calculated" = "darkgray")) +
ggthemes::theme_map() +
labs(fill = "Opportunity Score") +
theme(plot.title = element_text(hjust = 0.5, size = 15),
plot.background = element_rect(fill = "#edf3f9", colour = "#edf3f9"),
plot.subtitle = element_text(hjust = 0.5, size = 7),
plot.caption = element_text(hjust = 0.7, size = 9, face = "italic"),
legend.position = "bottom",
legend.justification = "center",
legend.background = element_rect(color = "black"),
legend.text = element_text(size = 14),
legend.title = element_text(size = 15),
legend.box.margin = margin(b = 1, unit = "cm"),
legend.key = element_rect(color = "black"),
legend.box.spacing = unit(0, "cm"),
legend.direction = "horizontal") +
guides(fill = guide_legend(nrow = 1))
ggsave("output/figures/figureA2.png", height = 10, width = 15, opp_score_map)
